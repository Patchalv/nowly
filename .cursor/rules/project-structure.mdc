---
description: Nowly Web App - Project Structure & Architecture Rules
globs:
alwaysApply: true
---

# ğŸ¦‰ Nowly Web App Structure

## ğŸ§© Overview

**Nowly** is a productivity-focused **Next.js 15 App Router** web app built using **CLEAN architecture principles**.  
It aims to deliver a â€œToday-firstâ€ task experience with Supabase as the backend.

**Core Stack**

- Framework: **Next.js 15 (App Router, React Server Components)**
- Database + Auth: **Supabase**
- Styling: **TailwindCSS + Shadcn/UI**
- Forms: **React Hook Form + Zod**
- State: **React Query (TanStack)**
- CI/CD: **GitHub Actions + Vercel**
- Language: **TypeScript**

---

## ğŸ“¦ Project Structure

```
nowly/
â”œâ”€â”€ app/                                # Next.js App Router root
â”‚   â”œâ”€â”€ (public)/                       # Publicly accessible routes
â”‚   â”‚   â”œâ”€â”€ page.tsx                    # Landing / marketing page
â”‚   â”‚   â”œâ”€â”€ login/                      # Supabase Auth
â”‚   â”‚   â”‚   â””â”€â”€ page.tsx
â”‚   â”‚   â””â”€â”€ signup/
â”‚   â”‚       â””â”€â”€ page.tsx
â”‚   â”‚
â”‚   â”œâ”€â”€ (protected)/                    # Authenticated routes
â”‚   â”‚   â”œâ”€â”€ layout.tsx                  # Dashboard layout (sidebar + header)
â”‚   â”‚   â”œâ”€â”€ daily/                      # "Daily" focused task view (Defaults to "today")
â”‚   â”‚   â”‚   â””â”€â”€ page.tsx
â”‚   â”‚   â”œâ”€â”€ tasks/                      # Master list
â”‚   â”‚   â”‚   â””â”€â”€ page.tsx
â”‚   â”‚   â””â”€â”€ settings/                   # Placeholder for later phases
â”‚   â”‚       â””â”€â”€ page.tsx
â”‚   â”‚
â”‚   â”œâ”€â”€ actions/                        # Server actions
â”‚   â”‚   â”œâ”€â”€ createTaskAction.ts
â”‚   â”‚   â””â”€â”€ updateTaskAction.ts
â”‚   â”‚
â”‚   â”œâ”€â”€ layout.tsx                      # Root layout (theme, providers, metadata)
â”‚   â”œâ”€â”€ globals.css                     # Tailwind global styles
â”‚   â””â”€â”€ page.tsx                        # Default redirect (e.g. to /login or /today)
â”‚
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ presentation/                   # UI layer (React components + hooks)
â”‚   â”‚   â”œâ”€â”€ components/                 # UI components (Shadcn/UI, shared)
â”‚   â”‚   â”œâ”€â”€ hooks/                      # UI state hooks (useUser, useTheme)
â”‚   â”‚   â”œâ”€â”€ pages/                      # Optional shared UI views
â”‚   â”‚   â””â”€â”€ providers/                  # Theme, Query, Supabase providers
â”‚   â”‚
â”‚   â”œâ”€â”€ application/                    # Use cases (business logic)
â”‚   â”‚   â”œâ”€â”€ tasks/                      # Task-specific domain actions
â”‚   â”‚   â”‚   â”œâ”€â”€ createTask.usecase.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ updateTask.usecase.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ listTasks.usecase.ts
â”‚   â”‚   â”‚   â””â”€â”€ deleteTask.usecase.ts
â”‚   â”‚   â””â”€â”€ categories/
â”‚   â”‚       â”œâ”€â”€ createCategory.usecase.ts
â”‚   â”‚       â””â”€â”€ listCategories.usecase.ts
â”‚   â”‚
â”‚   â”œâ”€â”€ domain/                         # Core entities and rules
â”‚   â”‚   â”œâ”€â”€ models/                     # Entity definitions (no framework deps)
â”‚   â”‚   â”‚   â”œâ”€â”€ Task.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ Category.ts
â”‚   â”‚   â”‚   â””â”€â”€ User.ts
â”‚   â”‚   â”œâ”€â”€ types/                      # Value objects, enums
â”‚   â”‚   â””â”€â”€ validation/                 # Zod schemas for domain validation
â”‚   â”‚
â”‚   â”œâ”€â”€ infrastructure/                 # Framework & DB layer (Supabase)
â”‚   â”‚   â”œâ”€â”€ supabase/                   # Supabase client & data adapters
â”‚   â”‚   â”‚   â”œâ”€â”€ client.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ types.ts                # Database types (snake_case)
â”‚   â”‚   â”‚   â””â”€â”€ taskRepository.ts
â”‚   â”‚   â”œâ”€â”€ repositories/               # Repository interfaces + impls
â”‚   â”‚   â”‚   â”œâ”€â”€ ITaskRepository.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ SupabaseCategoryRepository.ts
â”‚   â”‚   â”‚   â””â”€â”€ SupabaseTaskRepository.ts
â”‚   â”‚   â”œâ”€â”€ services/                   # External APIs, caching, etc.
â”‚   â”‚   â””â”€â”€ utils/                      # Infra-level utils
â”‚   â”‚
â”‚   â”œâ”€â”€ config/                         # Env vars, constants
â”‚   â”‚   â”œâ”€â”€ env.ts
â”‚   â”‚   â””â”€â”€ constants.ts
â”‚   â”‚
â”‚   â””â”€â”€ shared/                         # Common code
â”‚       â”œâ”€â”€ utils/                      # Formatting, dates, etc.
â”‚       â”œâ”€â”€ types/                      # Global types
â”‚       â””â”€â”€ errors/                     # Custom error classes
â”‚
â”œâ”€â”€ public/
â”œâ”€â”€ tests/                              # Unit + integration tests
â”‚   â”œâ”€â”€ domain/
â”‚   â”œâ”€â”€ application/
â”‚   â””â”€â”€ infrastructure/
â”‚
â”œâ”€â”€ .env.example
â”œâ”€â”€ tailwind.config.ts
â”œâ”€â”€ next.config.mjs
â””â”€â”€ package.json
```

---

## ğŸ”§ Development Conventions

### ğŸ§± Architecture Rules

- Follows **CLEAN architecture**:
  - `app` â†’ presentation (routing/UI)
  - `src/presentation` â†’ UI logic
  - `src/application` â†’ use cases (business logic)
  - `src/domain` â†’ entities + validation
  - `src/infrastructure` â†’ frameworks, DB, and APIs
- Each layer **only depends inward** (presentation â†’ application â†’ domain).  
  Infrastructure may depend on domain, but not vice versa.

### ğŸ“¥ Import Rules

- `presentation` may import from `application` and `domain`
- `application` may import from `domain` only
- `domain` must import from no other layer
- `infrastructure` may import from `domain` and `application`
- Never import directly from `infrastructure` into `presentation`
- Use `@/src/...` absolute paths for all imports

### ğŸ§© File Naming

| Type                       | Convention        |
| -------------------------- | ----------------- |
| Use case files             | `*.usecase.ts`    |
| Repository implementations | `Supabase*.ts`    |
| Entity models              | `PascalCase.ts`   |
| Components                 | `PascalCase.tsx`  |
| Hooks                      | `useSomething.ts` |
| Utilities                  | `camelCase.ts`    |

### ğŸ§­ Naming & Folder Conventions

- Folder names: **kebab-case**
- File names: **camelCase or PascalCase** (depending on type)
- No plural folder names unless they represent collections (e.g., `/tasks/`)

### ğŸ’» Component Rules

- Prefer **Server Components** by default.
- Add `"use client"` **only** when interactivity or state is required.
- UI components live under `src/presentation/components/`.

### ğŸ” Server Actions

- Defined in `app/actions/`
- Must only call use cases or repositories.
- Should never directly access Supabase client outside of infrastructure.

### ğŸ§¾ Environment Variables

- All environment variables are accessed via `src/config/env.ts`.
- Never access `process.env` directly in components or hooks.

### ğŸ§ª Testing

- Use **Vitest** for unit/integration tests.
- Tests mirror the directory of the source code (e.g., `tests/domain` for domain).
- No tests are placed in `/app`.

### ğŸ§© Style & Package Rules

- **Use npm only** (`npm install`, no yarn/pnpm)
- **TailwindCSS** used for styling
- **Shadcn/UI** for primitives and patterns
- **ESLint + Prettier** enforce formatting

## ğŸ§  Agent Guidance (for AI & Devs)

When generating code:

1. Identify which **layer** the file belongs to.
2. Ensure imports follow the **CLEAN dependency direction**.
3. Prefer **server-first** components in `/app`.
4. Use **repositories** for any Supabase or external data calls.
5. Wrap all root components in proper **providers** (Theme, Query, Supabase).
6. Maintain **type safety** using **Zod** schemas and shared types.
